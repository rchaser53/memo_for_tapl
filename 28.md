# 有界量化のメタ理論
## 型の露出
### SはΓの下でTへと露出する
- Γ|->S↑T
- TはSの最小の変数でない上位型

- 型の露出の結果は常に変数以外の何かの形をもつ最小の上位型
  - Γ=X<:Top,Y<:Nat->Nat,Z<:Y,W<:Z
    - Γ|->Top↑Top
    - Γ|->Y↑Nat->Nat
    - Γ|->W↑Nat->Nat
    - Γ|->X↑Top
    - Γ|->X↑Nat->Nat

### 露出
Γ|->S↑Tとするとき
1. Γ|->S<:T
2. Γ|-S<:UかつUが変数でないならば、Γ|-T<:U

## 最小型付け
1. Γ|->t:T ならば Γ|-t:T
2. Γ|-t:T  ならば Γ|->t:MかつΓ|-M<:T

## アルゴリズム的部分型関係の反射律
Γ|->T<:TはすべてのΓとTについて証明できる

## アルゴリズム部分型付けの推移律
Γ|->S<:QかつΓ|->Q<:TならばΓ|->S<:T

## アルゴリズム的部分型付けの健全性と完全性
Γ|-S<:Tの時、かつその時のみΓ|->S<:T

## 文脈Γに置ける型Tの重みはweightΓ(T)と書き、次のように定義される
- weightΓ(T)          = weightΓ1(U) + 1     Γ＝Γ1,X<:U,Γ2の場合
- weightΓ(Top)        = 1
- weightΓ(T1->T2)     = weightΓ(T1)+weightΓ(T2) + 1
- weightΓ(∀X<:T1.T2)  = weightΓ.X<T1(T2) + 1

- 部分型付け判断式Γ|-S<:Tの重みはΓに置けるSとTの重みの総和
- 部分型付けアルゴリズムはすべての入力について停止する
- カーネルF<:の部分型付けは決定可能である

## 並べ替えと弱化
- ΔをΓの正しい形式の並べ替えとする。Γ|->S<:TならばΔ|->S<:T
- Γ|->S<:Tかつdom(Δ)∩dom(Γ)=∅ ならば、Γ,Δ|->S<:T

## フルF<:における推移律と狭化
- Γ|->S<:QかつΓ|->Q<:Tならば、Γ|->S<:T
- Γ,X<:Q,Δ|->M<:NかつΓ|->P<:QならばΓ,X<:P,Δ|->M<:N

- フルとカーネルの規則との違いは非自明な同値類を生成する部分型付け規則を持つ何らかの機能(例えばレコード)を言語で拡張した時のみに現れる
- 例えばレコード付きの純粋なカーネルF<:では、型∀X<:{a:Top,b:Top}.Xは∀X<:{b:Top,a:Top}.Xの部分型とならないが、上の規則に寄れば部分型になる

- ¬S def= ∀X<:S.X
¬演算子の重要な性質は部分型付けの判断式の右辺と左辺を入れ替えられることである
- Γ|-¬S<:¬Tの時、かつその時のみΓ|-T<:S
- ¬Tは構文的な意味での否定

## Curry-Howard対応
- 型S->Tは論理的な命題S=>Tに対応し「¬S∨T」と同値
- ここで明らかに部分命題Sが「負」の位置(つまり含意全体が奇数個の否定の中)にある時、かつその時のみ含意全体は偶数この否定の中にある

- XとSが正の位置でのみ、かつTの負の位置でのみ出現するとする
  - X<:U|-S<:Tと|-[X->U]S<:[X->U]Tは同値

- 2カウンタ機械Mについて、部分型付け判断式S(M)が存在し、S(M)がフルF<:において導出可能である時、かつその時のみMの実行が停止する

- 部分型付けの決定不能性は28.4で説明した部分型付けの半アルゴリズムが健全でないことや完全でないことを意味しない
  - もし部分型付け判断式Γ|-S<:Tが宣言的な部分型付け規制で証明可能ならば、アルゴリズムは必ず停止しtrueを返す
  - もしΓ|-S<:Tが宣言的な部分型付け規則で証明可能でないならば、アルゴリズムは発散するかfalseを返す

### 問題はアルゴリズム的規則に置いては部分型付け判断式の証明が失敗する方法が2通りあること
1. 部分ゴールの無限の列を生成する(その結論をもつ有限の導出が存在しないことを意味)
2. Top<:S|-Tのような明らかな不整合に達すること
- 部分型付けのアルゴリズムは一方は検出できるが他方はできない

## 完全有界量化
- フルF<:の変種でTop型がなく変数の束縛としてX<:TとXの両方がある
  - つまり有界量化と非有界量化の両方
- 有界量化子と非有界量化子を混ぜることは許されない
  - 二つの有界量化子を比較する部分型付け規則や二つの非有界量化子を比較する規則はある
  - 有界量化子と非有界量化子を比較する規則は存在してはならない
  - 振り出しに戻ってしまうため

## 結び
- 任意の型の二つ組SとTの結び
  - SとTに共通する全ての上位型のうち最小の型J
- カーネルF<:の部分型関係では任意のSとTについて確かに結びが存在
- 共通する部分型を少なくとも一つ持つような任意のSとTに関する交わりが存在

## Γ|-S∨T=J
- Jは文脈Γに置いてSとTの結びである

## Γ|-S∧T=M
- MはΓに置いてSとTの交わりである

## 全域関数
- Γ|-S∨T=Jならば、Γ|-S<:JかつΓ|-T<:J
  - ∨(結び)は必ず型を返す
  - 結びはSとTの上界

- Γ|-S∧T=Mならば、Γ|-M<:SかつΓ|-M<:T
  - ∧(交わり)は型を返すか失敗する
  - 交わりは(存在すれば)下界

- Γ|-S<:VかつΓ|-T<:Vならば、Γ|-J<:VなるJが存在しΓ|-S∨T=J
  - 計算された結びはSとTに共通する全ての上界より小さいこと
- Γ|-L<:SかつΓ|-L<:Tならば、Γ|-L<:MなるMが存在しΓ|-S∧T=M
  - 交わりは共通する全ての下界よりも大きい(そしてSとTの共通の下界があれば常に存在する)こと
